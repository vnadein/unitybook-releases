# Документация по Системе Отчетности

Этот документ — исчерпывающее руководство по созданию, настройке и использованию **Отчетов** в системе UnityBook. Система отчетов — это мощный инструмент для анализа данных и получения ценных сведений о деятельности вашего предприятия.

## 1. Концепция Системы Отчетности

Если вы когда-либо работали со сводными таблицами в Excel, вы быстро освоите наш конструктор отчетов. Идея очень похожа, но с ключевыми преимуществами:

*   **Надежность:** Отчеты всегда строятся на актуальных данных из базы. Больше не нужно беспокоиться, последняя ли у вас версия Excel-файла.
*   **Производительность:** Система оптимизирована для работы с большими объемами данных, используя мощь базы данных и специальных [Регистров](./REGISTER.md).
*   **Безопасность:** Доступ к отчетам регулируется общей системой прав доступа.

**Основной принцип** — декларативность. Вы не программируете отчет, а "объясняете" системе, что вы хотите увидеть:
1.  **Какие данные использовать?** (Наборы данных)
2.  **Как их подготовить?** (Вычисляемые поля и ресурсы)
3.  **Как их сгруппировать и отобразить?** (Настройки)

---

## 2. Создание Нового Отчета

Все отчеты создаются и настраиваются в **Конфигураторе**.
1.  Перейдите в раздел "Отчеты".
2.  Нажмите "Добавить", чтобы создать новый отчет, или выберите существующий для редактирования.
3.  Перед вами откроется **Конструктор Отчетов**.

## 3. Конструктор Отчетов: Пошаговое Руководство

Конструктор представляет собой редактор с тремя вкладками, которые нужно заполнять последовательно: "Наборы данных" -> "Поля и Ресурсы" -> "Настройки".

### Вкладка 1: Наборы данных — Выбираем исходные данные

На этой вкладке вы говорите системе, какие "таблицы" из базы данных вам понадобятся для отчета.

*   **Что такое "Набор данных"?** Это просто ссылка на один из существующих в системе объектов: **Справочник**, **Документ** или **Регистр**.
*   **Как выбрать?** Нажмите "Добавить набор данных" и выберите нужный тип объекта и сам объект из списка.
*   **Рекомендация:** Для большинства аналитических отчетов (по остаткам, продажам, финансам) вашим основным источником данных должны быть **Регистры**. Они специально подготовлены для быстрой агрегации данных. Справочники обычно добавляют, чтобы получить дополнительные атрибуты (например, добавить "Страну производителя" из справочника "Номенклатура" в отчет по продажам).

**Пример:**
Для отчета "Продажи по товарам и клиентам" нам понадобятся:
1.  **Регистр "Продажи"**: содержит основные данные о сумме и количестве проданного товара.
2.  **Справочник "Номенклатура"**: чтобы добавить в отчет артикул или группу товара.
3.  **Справочник "Контрагенты"**: чтобы получить регион клиента.

Система автоматически свяжет эти наборы данных между собой, если в ваших объектах настроены поля-ссылки.

### Вкладка 2: Поля и Ресурсы — Готовим "ингредиенты"

На этой вкладке вы подготавливаете поля, которые будете использовать для построения отчета.

#### Вычисляемые поля
**Зачем это нужно?** Чтобы создать новые данные на основе существующих.
**Пример:** В регистре продаж у вас есть "СуммаПродажи" и "Себестоимость". Вы можете создать вычисляемое поле "Прибыль" с формулой: `[СуммаПродажи] - [Себестоимость]`.

**Как создать:**
1.  Нажмите "Добавить" в секции "Вычисляемые поля".
2.  **Идентификатор:** Придумайте короткое имя на английском (например, `profit`).
3.  **Заголовок:** Введите понятное имя, которое увидят пользователи (например, "Валовая Прибыль").
4.  **Выражение:** Напишите формулу, используя имена других полей в квадратных скобках `[]`.

#### Ресурсы
**Зачем это нужно?** Это **самый важный шаг** для получения итогов. Ресурсы — это числовые поля, которые система будет агрегировать (суммировать, считать количество и т.д.).
**Пример:** В отчете по продажам вы точно захотите увидеть итоговую сумму продаж и общее количество проданных товаров. Значит, "СуммаПродажи" и "Количество" должны быть ресурсами.

**Как создать:**
1.  Нажмите "Добавить" в секции "Ресурсы".
2.  **Поле:** Выберите из списка числовое поле (включая вычисляемые).
3.  **Функция агрегации:** Выберите, что с ним делать: `SUM` (Сумма), `COUNT` (Количество), `AVG` (Среднее), `MIN` (Минимум) или `MAX` (Максимум).

### Вкладка 3: Настройки — Собираем отчет

Это финальный и самый творческий этап. Здесь вы определяете структуру и внешний вид вашего отчета.

#### Группировки строк
**Зачем это нужно?** Чтобы создать иерархическую структуру отчета. Это аналог области "Строки" в сводных таблицах Excel.
**Как настроить:** Просто перетащите поля из списка "Доступные поля" в область "Группировки строк". Порядок полей определяет уровень вложенности.
**Пример:** Если вы перетащите сначала "Регион Клиента", а затем "Номенклатура", то отчет сгруппирует данные сначала по регионам, а внутри каждого региона — по товарам.

#### Колонки
**Зачем это нужно?** Чтобы выбрать, какие именно данные будут отображаться в колонках таблицы.
**Как настроить:** Просто отметьте галочками нужные поля в списке. В этот список попадают все доступные поля и созданные вами ресурсы.
**Пример:** Вы можете отметить `Регион Клиента`, `Номенклатура`, `SUM(Количество)` и `SUM(Прибыль)`.

#### Отборы (Фильтры)
**Зачем это нужно?** Чтобы ограничить данные, попадающие в отчет.
**Как настроить:**
1.  Нажмите "Добавить отбор".
2.  **Поле:** Выберите поле для фильтрации.
3.  **Оператор:** Выберите условие (`=`, `!=`, `В списке`, `Между` и т.д.).
4.  **Значение:** Укажите значение. Оно может быть постоянным (например, `Склад = "Основной"`) или динамическим, с помощью параметра.

#### Параметры
**Зачем это нужно?** Чтобы сделать отчет интерактивным. Вместо жестко заданного фильтра (например, `Дата >= 01.01.2024`), вы можете позволить пользователю самому выбирать период при каждом формировании отчета.
**Как создать:** Параметры создаются автоматически! Просто в значении отбора укажите имя параметра, начиная с символа `@`.
**Пример:**
1.  Создайте два отбора:
    -   `Дата >= @ДатаНачала`
    -   `Дата <= @ДатаКонца`
2.  Перейдите в секцию "Параметры". Вы увидите, что система автоматически создала два параметра: `@ДатаНачала` и `@ДатаКонца`.
3.  Все, что вам нужно сделать — это задать им понятные заголовки, например, "Начало периода" и "Конец периода". При запуске отчета система сама подставит нужные поля для ввода дат.

---

## 4. Пример: Отчет "Продажи по регионам"

Давайте создадим с нуля отчет, который покажет, в какие регионы мы продаем больше всего товаров.

1.  **Название отчета:** "Продажи по регионам".

2.  **Вкладка "Наборы данных":**
    *   Добавляем `Регистр: Продажи`.
    *   Добавляем `Справочник: Контрагенты`. Система свяжет их по полю `Контрагент`.

3.  **Вкладка "Поля и Ресурсы":**
    *   **Вычисляемые поля:** Нам не нужны.
    *   **Ресурсы:**
        *   Добавляем ресурс: Поле `СуммаПродажи`, Функция `SUM`.
        *   Добавляем ресурс: Поле `Количество`, Функция `SUM`.

4.  **Вкладка "Настройки":**
    *   **Группировки строк:** Перетаскиваем из доступных полей `Контрагенты.Регион`.
    *   **Колонки:** Отмечаем галочками `Контрагенты.Регион`, `SUM(Количество)` и `SUM(СуммаПродажи)`.
    *   **Отборы:** Добавляем отбор `Дата BETWEEN @НачалоПериода AND @КонецПериода`.
    *   **Параметры:** Система автоматически создала два параметра. Задаем им заголовки:
        *   `@НачалоПериода` -> "Начало периода"
        *   `@КонецПериода` -> "Конец периода"

**Готово!** Теперь, когда пользователь откроет этот отчет, он увидит два поля для ввода дат. После нажатия "Сформировать" он получит таблицу с колонками "Регион", "Количество" и "Сумма Продажи", где данные будут сгруппированы и просуммированы по каждому региону.
